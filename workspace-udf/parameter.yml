# ============================================================================
# parameter.yml — fabric-cicd parameterization for workspace-udf
# ============================================================================
# Handles environment-specific value replacement when deploying to target
# environments (TEST, PROD, etc.) via the fabric-cicd library.
#
# Lakehouse GUID Reference (source/DEV workspace):
#   6677c554-f58d-4371-81a4-c7b5a53648b7 → used as default in bronze_to_silver notebooks (labeled "maag_silver")
#   63081e19-3045-4aa1-b19f-6425719fe664 → used as default in schema/silver, run, data_mgmt/silver (labeled "maag_silver")
#                                           AND silver_to_gold notebooks (labeled "maag_gold")
#   400ee61d-0fae-4cb3-9d1d-e66011e11d3b → used as default in schema/gold, run_silver_to_gold, data_mgmt/gold (labeled "maag_gold")
#
# Workspace ID: 82249858-6617-405c-b4be-d40ea331378b (all notebooks)
#
# NOTE: GUID 63081e19 is labeled differently across notebook groups.
#       The rules below use file_path filters to map it correctly per context.
#       RULE ORDER MATTERS for this GUID — the filtered rule must precede the catch-all.
# ============================================================================

find_replace:

  # ==========================================================================
  # NOTEBOOK — Lakehouse ID Replacements
  # ==========================================================================

  # --- GUID 63081e19: → maag_gold (silver_to_gold notebooks ONLY) -----------
  # ORDER: MUST come BEFORE the catch-all rule for this GUID.
  # In silver_to_gold notebooks this GUID is the default_lakehouse (write target
  # for the gold layer) and appears in known_lakehouses[0].
  - find_value: "63081e19-3045-4aa1-b19f-6425719fe664"
    replace_value:
      _ALL_: "$items.Lakehouse.maag_gold.$id"
    item_type: "Notebook"
    file_path: "**/silver_to_gold/**/notebook-content.py"

  # --- GUID 63081e19: → maag_silver (all other notebooks) -------------------
  # Catch-all for remaining notebooks (schema/silver, run_bronze_to_silver,
  # data_mgmt/silver, and bronze_to_silver known_lakehouses entries).
  # After the rule above runs, this GUID is already replaced in silver_to_gold
  # files, so this rule only affects the remaining notebooks.
  - find_value: "63081e19-3045-4aa1-b19f-6425719fe664"
    replace_value:
      _ALL_: "$items.Lakehouse.maag_silver.$id"
    item_type: "Notebook"

  # --- GUID 6677c554: → maag_silver (bronze_to_silver default) --------------
  # Used as default_lakehouse and known_lakehouses[0] in all 16
  # bronze_to_silver notebooks.
  - find_value: "6677c554-f58d-4371-81a4-c7b5a53648b7"
    replace_value:
      _ALL_: "$items.Lakehouse.maag_silver.$id"
    item_type: "Notebook"

  # --- GUID 400ee61d: → maag_gold -------------------------------------------
  # Used as default_lakehouse in schema/gold, run_silver_to_gold, and
  # data_mgmt/gold notebooks, and as known_lakehouses entry in silver_to_gold.
  - find_value: "400ee61d-0fae-4cb3-9d1d-e66011e11d3b"
    replace_value:
      _ALL_: "$items.Lakehouse.maag_gold.$id"
    item_type: "Notebook"

  # ==========================================================================
  # NOTEBOOK — Workspace ID Replacement
  # ==========================================================================

  # All 49 notebooks with metadata reference the same workspace ID.
  - find_value: "82249858-6617-405c-b4be-d40ea331378b"
    replace_value:
      _ALL_: "$workspace.$id"
    item_type: "Notebook"

  # ==========================================================================
  # SEMANTIC MODEL — SQL Endpoint Replacement
  # ==========================================================================

  # The sales_dashboard semantic model connects to maag_gold via its SQL
  # endpoint (defined as an expression parameter in expressions.tmdl).
  # All table partitions use: Sql.Database(sqlEndpoint, database)
  - find_value: "ccllgusga4suzkb52t4j7lpn7y-lcmcjaqxmzoebnf62qhkgmjxrm.datawarehouse.fabric.microsoft.com"
    replace_value:
      _ALL_: "$items.Lakehouse.maag_gold.$sqlendpoint"
    item_type: "SemanticModel"

  # ==========================================================================
  # DATA AGENT — Lakehouse Reference Replacement
  # ==========================================================================

  # The Data Agent datasource.json stores the maag_gold lakehouse reference
  # as artifactId. This must resolve to the deployed lakehouse item ID.
  - find_value: "11e11d3b-e660-9d1d-4cb3-0fae400ee61d"
    replace_value:
      _ALL_: "$items.Lakehouse.maag_gold.$id"
    item_type: "DataAgent"

# ============================================================================
# NOTE on .platform logicalId:
# The key_value_replace parameter does NOT process .platform files (they are
# intentionally excluded by fabric-cicd to maintain item integrity). LogicalId
# mapping is handled automatically by the library during deployment.
# ============================================================================
